# workflow start
name: Run Test

on: [pull_request]

jobs:
  # test build success
  build:
    # macos-latest is macos-11, macos-12 available but swift pm cache doesn't work
    runs-on: macos-latest
    steps:
    # https://github.com/actions/cache/blob/main/examples.md#swift---swift-package-manager
    - name: Checkout
      uses: actions/checkout@v2

    - name: SwiftPM Cahce
      uses: actions/cache@v2
      with:
        path: .build
        key: ${{ runner.os }}-spm-${{ hashFiles('**/Package.resolved') }}
        restore-keys: |
          ${{ runner.os }}-spm-

    - name: Build Test
      run: xcodebuild -project Samplero/Samplero.xcodeproj -scheme Samplero -destination 'platform=iOS Simulator,OS=latest,name=iPhone 13 Pro' -quiet clean build

  # check build warnings
  SwiftLint:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: GitHub Action for SwiftLint (Only files changed in the PR) with --strict
      uses: norio-nomura/action-swiftlint@3.2.1
      # treat as error
      # with:
      #   args: --strict
